# Research: Programmatic Access to Claude via Subscription

**Date:** 2026-02-19
**Purpose:** Evaluate how third-party tools integrate with Claude Pro/Max subscriptions instead of the paid API, and identify viable approaches for Canon.

---

## Background

Anthropic offers two billing models for Claude access:

| Model | Billing | Programmatic Access |
|-------|---------|-------------------|
| Pro/Max subscription ($20-$200/mo) | Flat monthly fee | Claude.ai web UI + Claude Code CLI only |
| Anthropic API | Pay-per-token | Full programmatic access via API keys |

There is **no officially supported way** to use a subscription for arbitrary programmatic/tool access. The subscription is explicitly tied to Anthropic's own products.

---

## Tools and Approaches Investigated

### 1. OpenCode

- **Repo:** github.com/opencode-ai/opencode
- **What it is:** Open-source terminal coding agent (by the SST team), supports 75+ models.
- **How it connected:** Extracted Claude Code's OAuth token from the system keychain and impersonated the official CLI by sending matching client headers.
- **Current status:** Blocked by Anthropic in January 2026. Now requires API keys or community proxy workarounds (e.g. `opencode-claude-max-proxy` which wraps the Agent SDK).

### 2. Clawd (HMilbradt/clawd)

- **Repo:** github.com/HMilbradt/clawd
- **What it is:** A task orchestrator, not an API proxy. Spawns actual `claude` CLI processes with `--dangerously-skip-permissions` to automate multi-step development tasks.
- **How it connects:** Calls the official CLI binary as a subprocess. Auth flows through the CLI's existing subscription credentials.
- **Key distinction:** Does not provide API-like access. It automates the CLI itself.

### 3. Clawdbot / OpenClaw

- **Repo:** github.com/clawdbot/clawdbot (now openclaw.ai)
- **What it is:** A locally-running personal AI assistant with screen control, file access, and messaging integrations. 30K+ GitHub stars.
- **How it connected:** Previously used OAuth tokens directly. After the January 2026 block, switched to CLI subprocess wrappers (`claude-max-api-proxy`) that expose an OpenAI-compatible HTTP API.

### 4. CLI Subprocess Proxies (Multiple Projects)

The most common surviving approach. All follow the same architecture:

```
Client App  -->  Local Proxy (localhost)  -->  claude -p --output-format stream-json
                 Translates API format          Uses subscription OAuth from keychain
                 to CLI args and back
```

| Project | Language | Notes |
|---------|----------|-------|
| claude-max-api-proxy | Node.js | OpenAI-compatible HTTP API |
| CLIProxyAPI | Go | Single binary, supports Claude + Gemini + Codex |
| opencode-claude-max-proxy | TypeScript | ~200 lines, uses Agent SDK `query()` |
| ccproxy-api | Python | Plugin-based, multi-provider |

### 5. Claude Agent SDK

- **Packages:** `claude-agent-sdk` (Python), `@anthropic-ai/claude-agent-sdk` (TypeScript)
- **Official auth methods:** Anthropic API key, AWS Bedrock, Google Vertex, Azure Foundry.
- **Subscription auth:** Technically works via `CLAUDE_CODE_OAUTH_TOKEN` (generated by `claude setup-token`). Community demos confirm this. However, the docs explicitly state:

  > "Anthropic does not allow third party developers to offer claude.ai login or rate limits for their products, including agents built on the Claude Agent SDK."

- **Open issue:** github.com/anthropics/claude-agent-sdk-python/issues/559 requests Max plan billing support. No timeline.

---

## The January 2026 Crackdown

On January 9, 2026, Anthropic deployed server-side restrictions:

- OAuth tokens were locked to only work within the official Claude Code application.
- Third-party tools using reused/spoofed tokens broke overnight.
- Error: *"This credential is only authorized for use with Claude Code and cannot be used for other API requests."*
- User accounts were banned for triggering abuse filters from third-party harnesses.
- Thariq Shihipar (Anthropic) confirmed this was intentional policy enforcement.

**Economic motivation:** Claude Max at $200/mo provides significant usage. The same volume via API could cost $1,000+/mo. Proxy tools created an unsustainable arbitrage.

---

## How Legitimate Tools Handle Claude

| Tool | Approach | Subscription? |
|------|----------|--------------|
| Cursor | Commercial agreement with Anthropic | Yes, bundled in Cursor Pro ($20/mo) |
| Windsurf | Commercial agreement with Anthropic | Yes, via Windsurf credits |
| Cline | Bring-your-own API key only | No |
| Roo Code | API keys only (has open issue for OAuth) | No |
| Continue.dev | API keys or proxy | No |

**Key insight:** Cursor and Windsurf pay Anthropic wholesale rates and bundle Claude into their pricing. This is the only fully legitimate path for third-party tools.

---

## Relevant Claude Code CLI Flags

```bash
claude -p "query"                          # Non-interactive, print result, exit
claude -p --output-format stream-json      # Streaming NDJSON (every token/turn/tool)
claude -p --output-format json             # Structured JSON with metadata
claude -p --input-format stream-json       # Accept streaming JSON input
claude -p --include-partial-messages       # Partial streaming events (needs stream-json)
claude -p --max-turns N                    # Limit agentic turns
claude -p --max-budget-usd N              # Limit spending
```

The `stream-json` output format emits newline-delimited JSON that can be parsed programmatically. Combined with subprocess spawning, this is the foundation of all CLI proxy approaches.

---

## TOS and Risk Assessment

### Anthropic Legal & Compliance Page (Updated 2026-02-20)

Source: [code.claude.com/docs/en/legal-and-compliance](https://code.claude.com/docs/en/legal-and-compliance)

Anthropic published a formal "Authentication and credential use" policy:

> "OAuth authentication (used with Free, Pro, and Max plans) is intended exclusively for Claude Code and Claude.ai. Using OAuth tokens obtained through Claude Free, Pro, or Max accounts in any other product, tool, or service — including the Agent SDK — is not permitted and constitutes a violation of the Consumer Terms of Service."

> "Developers building products or services that interact with Claude's capabilities, including those using the Agent SDK, should use API key authentication through Claude Console or a supported cloud provider. Anthropic does not permit third-party developers to offer Claude.ai login or to route requests through Free, Pro, or Max plan credentials on behalf of their users."

> "Anthropic reserves the right to take measures to enforce these restrictions and may do so without prior notice."

This formalizes what was previously only communicated via GitHub issues and community enforcement. Key implications:

- The Agent SDK + OAuth path is now **explicitly prohibited**, not just discouraged
- CLI subprocess wrappers that route through subscription OAuth fall under "any other product, tool, or service"
- The distinction between "using Claude Code" and "building a product that spawns Claude Code" is ambiguous — Canon spawns the real `claude` binary (it *is* Claude Code running), but Canon itself is a separate product
- API key authentication is the only officially sanctioned path for third-party developers

### Anthropic Consumer Terms of Service -- Section 3.7

> "[You agree not] to access the Services through automated or non-human means, whether through a bot, script, or otherwise" -- except when accessing via an Anthropic API Key or where explicitly permitted.

### Risk Matrix

| Approach | TOS Risk | Technical Risk | Longevity |
|----------|----------|----------------|-----------|
| Direct OAuth token reuse | **High** -- blocked, bans issued | **High** -- server-side restricted | Dead |
| CLI subprocess wrapper | **Medium** -- violates automated access clause | **Medium** -- could be fingerprinted | Uncertain |
| Agent SDK + OAuth token | **High** -- explicitly prohibited as of 2026-02-20 | **Low** -- works today | Dead |
| Anthropic API key | **None** -- fully supported | **None** | Stable |
| Commercial agreement | **None** -- explicitly authorized | **None** | Stable |

---

## Conclusions

### What exists today

1. **API keys** -- The only fully supported programmatic path. Pay-per-token.
2. **CLI subprocess wrappers** -- The community's workaround post-crackdown. Spawns `claude -p` as a subprocess, parses output. Works with subscriptions but sits in a policy grey area.
3. **Agent SDK with OAuth** -- Now explicitly prohibited by Anthropic's legal page (2026-02-20). No longer a viable option.

### What doesn't exist

- An official way to use Pro/Max subscriptions for third-party tool access.
- Any announced plans to change this (the open GitHub issue has no timeline).
- A proxy approach that is both subscription-based AND fully policy-compliant.

### Decision for Canon

**CLI subprocess** (`claude -p --output-format stream-json`) is the chosen approach.

Canon is a personal development tool, not a published product. It spawns the real `claude` binary, which handles its own OAuth internally — Canon never extracts, stores, or proxies tokens. This is the most practical path for personal use with a Max subscription.

If Canon were ever distributed publicly, the auth model would need to be revisited: either requiring API key authentication or securing an agreement with Anthropic. Until then, CLI subprocess is the way forward.

### Eliminated options

| Option | Reason eliminated |
|--------|-------------------|
| **Agent SDK + OAuth** | Explicitly prohibited by Anthropic's 2026-02-20 legal update |
| **Require API keys** | Double-billing (pay-per-token on top of Max subscription) for personal use |
| **Stay CLI-only** (slash command model) | Too limited — Canon-as-IDE requires session management, not one-shot review |
| **Wait for official support** | No timeline, may never happen |
| **Contact Anthropic** | Not warranted for personal tooling |
